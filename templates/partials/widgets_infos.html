<div class="col-span-1 md:col-span-2 lg:col-span-4 grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- 1. Météo -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-6 shadow-lg border border-gray-700 h-56 flex flex-col justify-between relative overflow-hidden">
        <div class="flex justify-between items-start z-10">
            <div>
                <h3 class="font-bold text-white text-xl">Météo</h3>
                <p class="text-sm text-gray-400 uppercase tracking-wider mt-1">Montréal, QC</p>
            </div>
            <div class="text-right">
                <div id="current-temp" class="text-4xl font-bold text-white">--°</div>
                <div id="current-desc" class="text-xs text-gray-400 capitalize">Chargement...</div>
            </div>
        </div>
        <div id="forecast-grid" class="grid grid-cols-3 gap-2 mt-4 z-10">
           </div>
        <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-blue-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
        <div class="absolute -left-10 -top-10 w-40 h-40 bg-orange-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10"></div>
    </div>

    <!-- 2. Horloges -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-56 flex flex-col">
        <div class="flex flex-col items-center justify-center flex-1 mb-2">
            <h3 class="font-bold text-orange-400 w-full text-center mb-1 text-sm uppercase tracking-wide">Montréal</h3>
            <div id="clock-display" class="text-4xl font-mono text-blue-400 font-bold leading-none">--:--</div>
            <div id="date-display" class="text-gray-500 text-xs mt-1 capitalize">Chargement...</div>
        </div>

        <div class="grid grid-cols-3 gap-2 border-t border-gray-700 pt-2">
            <div class="text-center">
                <div class="text-gray-300 text-xs uppercase font-bold">Paris</div>
                <div id="clock-paris" class="text-white font-mono text-sm font-bold">--:--</div>
            </div>
            <div class="text-center border-l border-gray-700">
                <div class="text-gray-300 text-xs uppercase font-bold">SF</div>
                <div id="clock-sf" class="text-white font-mono text-sm font-bold">--:--</div>
            </div>
            <div class="text-center border-l border-gray-700">
                <div class="text-gray-300 text-xs uppercase font-bold">Pékin</div>
                <div id="clock-pekin" class="text-white font-mono text-sm font-bold">--:--</div>
            </div>
        </div>
    </div>

    <!-- 3. Monitoring Système -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-56 flex flex-col justify-center"
         hx-get="{% url 'system_monitor' %}"
         hx-trigger="load, every 8s">
        <div class="text-center text-gray-500 text-xs animate-pulse">
            Chargement sys...
        </div>
    </div>

    <!-- 4. Marchés -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 overflow-hidden">
        <h3 class="font-bold text-orange-400 mb-2 text-lg">Marchés</h3>
        <div class="tradingview-widget-container h-full">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
          {
              "colorTheme": "dark",
              "dateRange": "12M",
              "showChart": false,
              "locale": "fr",
              "largeChartUrl": "",
              "isTransparent": true,
              "showSymbolLogo": true,
              "showFloatingTooltip": false,
              "width": "100%",
              "height": "100%",
              "tabs": [
                {
                  "title": "Indices",
                  "symbols": [
                    { "s": "FOREXCOM:SPXUSD", "d": "S&P 500" },
                    { "s": "TSX:TSX", "d": "Toronto TSX" },
                    { "s": "BITSTAMP:BTCUSD", "d": "Bitcoin" },
                    { "s": "FX_IDC:EURUSD", "d": "EUR / USD" },
                    { "s": "NASDAQ:EH", "d": "EH" }
                  ]
                }
              ]
            }
          </script>
        </div>
    </div>

    <!-- 5. Calendrier -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 flex flex-col">
         <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-1">
            <h3 id="cal-month-year" class="font-bold text-orange-400 capitalize text-sm">--</h3>
            <div class="text-[10px] text-gray-500 bg-gray-900 px-2 py-0.5 rounded">Aujourd'hui</div>
        </div>
        <div class="grid grid-cols-7 gap-1 text-center mb-1">
            <div class="text-gray-500 text-[10px] font-bold">L</div>
            <div class="text-gray-500 text-[10px] font-bold">M</div>
            <div class="text-gray-500 text-[10px] font-bold">M</div>
            <div class="text-gray-500 text-[10px] font-bold">J</div>
            <div class="text-gray-500 text-[10px] font-bold">V</div>
            <div class="text-gray-500 text-[10px] font-bold">S</div>
            <div class="text-gray-500 text-[10px] font-bold">D</div>
        </div>
        <div id="cal-days" class="grid grid-cols-7 gap-1 text-center text-xs flex-1 content-start"></div>
    </div>

    <!-- 6. Calculatrice -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 flex flex-col">
        <h3 class="font-bold text-orange-400 mb-2 text-lg">Calculatrice</h3>
        <!-- Écran -->
        <input type="text" id="calc-display" readonly
               class="w-full bg-gray-900 text-right text-xl text-white p-2 rounded mb-2 border border-gray-700 focus:outline-none font-mono tracking-widest"
               placeholder="0">

        <!-- Touches -->
        <div class="grid grid-cols-4 gap-2 flex-1">
            <!-- Ligne 1 -->
            <button onclick="calcInput('C')" class="bg-red-900/40 hover:bg-red-800 text-red-200 rounded font-bold text-xs transition-colors">C</button>
            <button onclick="calcInput('/')" class="bg-gray-700 hover:bg-gray-600 rounded text-blue-400 font-bold transition-colors">÷</button>
            <button onclick="calcInput('*')" class="bg-gray-700 hover:bg-gray-600 rounded text-blue-400 font-bold transition-colors">×</button>
            <button onclick="calcInput('DEL')" class="bg-gray-700 hover:bg-gray-600 rounded text-orange-400 font-bold transition-colors">⌫</button>

            <!-- Ligne 2 -->
            <button onclick="calcInput('7')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">7</button>
            <button onclick="calcInput('8')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">8</button>
            <button onclick="calcInput('9')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">9</button>
            <button onclick="calcInput('-')" class="bg-gray-700 hover:bg-gray-600 rounded text-blue-400 font-bold transition-colors">-</button>

            <!-- Ligne 3 -->
            <button onclick="calcInput('4')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">4</button>
            <button onclick="calcInput('5')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">5</button>
            <button onclick="calcInput('6')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">6</button>
            <button onclick="calcInput('+')" class="bg-gray-700 hover:bg-gray-600 rounded text-blue-400 font-bold transition-colors">+</button>

            <!-- Ligne 4 -->
            <button onclick="calcInput('1')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">1</button>
            <button onclick="calcInput('2')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">2</button>
            <button onclick="calcInput('3')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">3</button>
            <button onclick="calcResult()" class="row-span-2 bg-blue-600 hover:bg-blue-500 rounded font-bold text-white transition-colors">=</button>

            <!-- Ligne 5 -->
            <button onclick="calcInput('0')" class="col-span-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">0</button>
            <button onclick="calcInput('.')" class="bg-gray-700 hover:bg-gray-600 rounded text-sm font-bold transition-colors">.</button>
        </div>
    </div>

    <!-- 7. Minuteur Pomodoro (NOUVEAU) -->
    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 flex flex-col items-center justify-center relative overflow-hidden">
        <h3 class="font-bold text-orange-400 mb-4 text-lg absolute top-4 left-4">Pomodoro</h3>

        <!-- Cercle de progression (SVG) -->
        <div class="relative w-32 h-32 flex items-center justify-center">
            <svg class="w-full h-full transform -rotate-90">
                <circle cx="64" cy="64" r="60" stroke="currentColor" stroke-width="6" fill="transparent" class="text-gray-700" />
                <circle id="pomo-progress" cx="64" cy="64" r="60" stroke="currentColor" stroke-width="6" fill="transparent" class="text-blue-500 transition-all duration-1000 ease-linear" stroke-dasharray="377" stroke-dashoffset="0" />
            </svg>
            <div id="pomo-timer" class="absolute text-3xl font-mono font-bold text-white">25:00</div>
        </div>

        <!-- Contrôles -->
        <div class="flex gap-4 mt-4 z-10">
            <button onclick="startPomo()" id="btn-start" class="bg-green-600 hover:bg-green-500 text-white px-4 py-1 rounded text-sm font-bold transition-colors">Start</button>
            <button onclick="resetPomo()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-1 rounded text-sm font-bold transition-colors">Reset</button>
        </div>

        <!-- Modes -->
        <div class="flex gap-2 mt-2 text-xs text-gray-400">
            <span onclick="setPomo(25)" class="cursor-pointer hover:text-white border-b border-transparent hover:border-white">Travail</span>
            <span>|</span>
            <span onclick="setPomo(5)" class="cursor-pointer hover:text-white border-b border-transparent hover:border-white">Pause</span>
        </div>
    </div>

    <script>
        // --- CALCULATRICE ---
        function calcInput(val) {
            const display = document.getElementById('calc-display');
            if (val === 'C') {
                display.value = '';
            } else if (val === 'DEL') {
                display.value = display.value.slice(0, -1);
            } else {
                display.value += val;
            }
        }

        function calcResult() {
            const display = document.getElementById('calc-display');
            try {
                if(display.value) {
                    display.value = eval(display.value);
                }
            } catch {
                const old = display.value;
                display.value = 'Err';
                setTimeout(() => display.value = old, 1000);
            }
        }

        // --- POMODORO ---
        let pomoInterval;
        let pomoTime = 25 * 60;
        let pomoTotalTime = 25 * 60;
        let isRunning = false;

        function updateDisplay() {
            const minutes = Math.floor(pomoTime / 60);
            const seconds = pomoTime % 60;
            document.getElementById('pomo-timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // Mise à jour du cercle SVG
            const circle = document.getElementById('pomo-progress');
            const offset = 377 - (377 * pomoTime / pomoTotalTime);
            circle.style.strokeDashoffset = offset;
        }

        function startPomo() {
            if (isRunning) {
                clearInterval(pomoInterval);
                document.getElementById('btn-start').textContent = "Start";
                document.getElementById('btn-start').classList.replace('bg-yellow-600', 'bg-green-600');
                isRunning = false;
            } else {
                pomoInterval = setInterval(() => {
                    if (pomoTime > 0) {
                        pomoTime--;
                        updateDisplay();
                    } else {
                        clearInterval(pomoInterval);
                        alert("Temps écoulé !");
                        resetPomo();
                    }
                }, 1000);
                document.getElementById('btn-start').textContent = "Pause";
                document.getElementById('btn-start').classList.replace('bg-green-600', 'bg-yellow-600');
                isRunning = true;
            }
        }

        function resetPomo() {
            clearInterval(pomoInterval);
            pomoTime = pomoTotalTime;
            isRunning = false;
            document.getElementById('btn-start').textContent = "Start";
            document.getElementById('btn-start').classList.replace('bg-yellow-600', 'bg-green-600');
            updateDisplay();
        }

        function setPomo(minutes) {
            pomoTotalTime = minutes * 60;
            resetPomo();
        }
    </script>

</div>