<!--
    Ce fichier est le template principal et unique du tableau de bord personnel.
    Il est rendu par Django et contient toute la structure de l'interface.

    FONCTIONNEMENT :
    - Django : Gère le rendu initial de la page, l'affichage des données (pages, widgets, liens)
      et traite les requêtes POST pour les modifications de la base de données.
    - HTMX : Utilisé pour rendre l'application dynamique sans rechargement de page.
      Les actions comme l'ajout, la suppression ou la modification d'éléments
      se font via des requêtes AJAX déclenchées par des attributs `hx-*`.
    - Tailwind CSS : Framework CSS utilisé pour styliser l'ensemble de l'application
      avec une approche "utility-first". Le mode sombre (`dark`) est activé par défaut.
    - SortableJS : Bibliothèque JavaScript qui permet de réorganiser les éléments
      (liens, widgets, onglets) par glisser-déposer (Drag & Drop).
    - JavaScript Vanilla : Utilisé pour la gestion des modales, des menus contextuels,
      de l'horloge, de la météo, du calendrier et du "Mode Zen".

    STRUCTURE :
    1.  HEAD : Importation des librairies (Tailwind, HTMX, SortableJS) et styles CSS.
    2.  NAVIGATION PRINCIPALE : Barre supérieure affichant les onglets (Pages) et les boutons de gestion.
    3.  BARRE DE RECHERCHE : Formulaire de recherche Google et bouton d'ajout de catégorie.
    4.  CONTENU PRINCIPAL :
        - Affiche une grille de "widgets" (catégories) pour la page active.
        - Gère le cas spécial de la page "Infos" pour afficher des widgets système (météo, horloge, etc.).
        - Chaque widget est rendu via une inclusion du template partiel `partials/widget.html`.
    5.  MENUS CONTEXTUELS : Menus cachés qui apparaissent au clic droit sur un lien ou un widget.
    6.  MODALES : Fenêtres pop-up pour les actions de création, renommage et suppression.
    7.  BOUTONS FLOTTANTS : "Mode Zen" et "Backup".
    8.  SCRIPTS : Contient toute la logique côté client (Drag & Drop, gestion des modales, horloge, etc.).
-->
{% load static %}
<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Perso</title>

    <!-- Importation des librairies JS -->
    <script src="{% static 'js/tailwind.js' %}"></script>
    <script src="{% static 'js/htmx.js' %}"></script>
    <script src="{% static 'js/sortable.js' %}"></script>

    <!-- Configuration de Tailwind CSS en JavaScript -->
    <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            gray: {
                                900: '#111827',
                                800: '#1f2937',
                                700: '#374151',
                            }
                        }
                    }
                }
            }
    </script>

    <!-- Styles CSS additionnels -->
    <style>
        #context-menu { display: none; position: absolute; z-index: 50; }
        .sortable-ghost { opacity: 0.4; background-color: #4B5563; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans min-h-screen select-none"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'> <!-- Ajoute le token CSRF à toutes les requêtes HTMX -->

<!-- =================================== -->
<!-- NAVIGATION PRINCIPALE (ONGLETS/PAGES) -->
<!-- =================================== -->
{% include "partials/nav_header.html" %}

<!-- =================================== -->
<!-- CONTENU PRINCIPAL (GRILLE DE WIDGETS) -->
<!-- =================================== -->
<div class="p-6 main-content">
    {% if active_page %}

        <!-- Grille responsive qui contient tous les widgets -->
        <div id="widget-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

            {% if active_page.slug == 'infos' %}
                {% include "partials/widgets_infos.html" %}
            {% endif %}

            <!-- Boucle pour afficher les widgets créés par l'utilisateur -->
            {% for widget in active_page.widgets.all %}
                {% include "partials/widget.html" %}
            {% endfor %}

        </div>

    {% else %}
        <!-- Message affiché si aucune page n'est configurée -->
        <div class="text-center text-gray-500 mt-10">Aucune page configurée. Lancez la commande seed_db !</div>
    {% endif %}
</div>

<!-- =================================== -->
<!-- MENUS CONTEXTUELS (CLIC DROIT)      -->
<!-- =================================== -->
{% include "partials/menus.html" %}

<!-- =================================== -->
<!-- MODALES (FENÊTRES POP-UP)           -->
<!-- =================================== -->
{% include "partials/modals.html" %}

<!-- =================================== -->
<!-- SCRIPTS JAVASCRIPT                  -->
<!-- =================================== -->
{% include "partials/scripts.html" %}
</body>
</html>