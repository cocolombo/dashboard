<div class="col-span-1 md:col-span-2 lg:col-span-4 grid grid-cols-1 md:grid-cols-3 gap-6">

    <div class="col-span-1 bg-gray-800 rounded-lg p-6 shadow-lg border border-gray-700 h-48 flex flex-col justify-between relative overflow-hidden">
        <div class="flex justify-between items-start z-10">
            <div>
                <h3 class="font-bold text-white text-xl">Météo</h3>
                <p class="text-sm text-gray-400 uppercase tracking-wider mt-1">Montréal, QC</p>
            </div>
            <div class="text-right">
                <div id="current-temp" class="text-4xl font-bold text-white">--°</div>
                <div id="current-desc" class="text-xs text-gray-400 capitalize">Chargement...</div>
            </div>
        </div>
        <div id="forecast-grid" class="grid grid-cols-3 gap-2 mt-4 z-10">
           </div>
        <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-blue-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
        <div class="absolute -left-10 -top-10 w-40 h-40 bg-orange-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10"></div>
    </div>

    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-48 flex flex-col justify-center items-center">
        <h3 class="font-bold text-orange-400 w-full text-left mb-2">Heure Locale</h3>
        <div id="clock-display" class="text-4xl font-mono text-blue-400 font-bold tracking-wider">--:--:--</div>
        <div id="date-display" class="text-gray-400 text-lg mt-2 capitalize">Chargement...</div>
    </div>

    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-48 flex flex-col justify-center"
         hx-get="{% url 'system_monitor' %}"
         hx-trigger="load, every 8s">
        <div class="text-center text-gray-500 text-xs animate-pulse">
            Chargement sys...
        </div>
    </div>

    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 overflow-hidden">
        <h3 class="font-bold text-orange-400 mb-2 text-lg">Marchés</h3>
        <div class="tradingview-widget-container h-full">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
          {
              "colorTheme": "dark",
              "dateRange": "12M",
              "showChart": false,
              "locale": "fr",
              "largeChartUrl": "",
              "isTransparent": true,
              "showSymbolLogo": true,
              "showFloatingTooltip": false,
              "width": "100%",
              "height": "100%",
              "tabs": [
                {
                  "title": "Indices",
                  "symbols": [
                    { "s": "FOREXCOM:SPXUSD", "d": "S&P 500" },
                    { "s": "TSX:TSX", "d": "Toronto TSX" },
                    { "s": "BITSTAMP:BTCUSD", "d": "Bitcoin" },
                    { "s": "FX_IDC:EURUSD", "d": "EUR / USD" }
                  ]
                }
              ]
            }
          </script>
        </div>
    </div>

    <div class="col-span-1 bg-gray-800 rounded-lg p-4 shadow-lg border border-gray-700 h-64 flex flex-col">
         <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-1">
            <h3 id="cal-month-year" class="font-bold text-orange-400 capitalize text-sm">--</h3>
            <div class="text-[10px] text-gray-500 bg-gray-900 px-2 py-0.5 rounded">Aujourd'hui</div>
        </div>
        <div class="grid grid-cols-7 gap-1 text-center mb-1">
            <div class="text-gray-500 text-[10px] font-bold">L</div>
            <div class="text-gray-500 text-[10px] font-bold">M</div>
            <div class="text-gray-500 text-[10px] font-bold">M</div>
            <div class="text-gray-500 text-[10px] font-bold">J</div>
            <div class="text-gray-500 text-[10px] font-bold">V</div>
            <div class="text-gray-500 text-[10px] font-bold">S</div>
            <div class="text-gray-500 text-[10px] font-bold">D</div>
        </div>
        <div id="cal-days" class="grid grid-cols-7 gap-1 text-center text-xs flex-1 content-start"></div>
    </div>

    {% for widget in active_page.widgets.all %}
        {% if widget.title == "Scripts" %}
             <div class="col-span-1 h-64 overflow-hidden relative group">
                {% include "partials/widget.html" %}
            </div>
        {% endif %}
    {% endfor %}

</div>